FROM python:3.11-slim

WORKDIR /app

# Install dependencies (cached unless pyproject.toml changes)
COPY pyproject.toml .
RUN mkdir -p src/rawl && touch src/rawl/__init__.py \
    && pip install --no-cache-dir . \
    && rm -rf src/rawl

# Copy actual source and reinstall (fast â€” deps already cached)
COPY src/ src/
RUN pip install --no-cache-dir --no-deps .

CMD ["arq", "rawl.arq_app.WorkerSettings"]
